<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>USB 主机（仅适用于 MDK 专业版）</title>
<title>USB 组件：USB 主机（仅适用于 MDK 专业版）</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">USB 组件
   &#160;<span id="projectnumber">版本 6.12.4</span>
   </div>
   <div id="projectbrief">用于 USB 设备和主机通信的 MDK 中间件</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>主&#160;页</span></a></li>
      <li class="current"><a href="pages.html"><span>用法&#160;和&#160;描述</span></a></li>
      <li><a href="modules.html"><span>参考</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_u_s_b__host.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全部</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>数据结构</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>函数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>变量</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>枚举</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>枚举</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>组</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>页面</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">USB 主机（仅适用于 MDK 专业版）</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul><li class="level1"><a href="#Create_a_USB_Host_Application">创建一个 USB 主机应用程序</a><ul><li class="level2"><a href="#RTE_Software_Component_Selection_USBH">RTE 组件选择</a></li>
<li class="level2"><a href="#USB_Driver_Configuration_USBH">USB 驱动程序和控制器</a></li>
<li class="level2"><a href="#USB_Host_Configuration_USBH">USB 主机配置</a></li>
<li class="level2"><a href="#usbh_system_resources">系统资源配置</a></li>
<li class="level2"><a href="#USB_Device_Class_Configuration_USBH">可连接的 USB 设备的配置</a></li>
<li class="level2"><a href="#USBH_User_Code_Implementation">用户代码实现</a></li>
<li class="level2"><a href="#usbh_debugging">调试</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>本章介绍 USB 主机组件的软件结构，并说明它用于创建 USB 主机应用程序。该软件组件仅供 MDK 专业版的用户使用。</p>
<p>USB 主机组件简化了允许连接 USB 设备的微控制器系统的软件开发。USB 主机组件的属性是：</p>
<ul>
<li>符合 USB 2.0 规范。</li>
<li>支持将 <a class="el" href="_h_i_d.html">HID</a>，<a class="el" href="_m_s_c.html">MSC</a>，<a class="el" href="_c_d_c.html">CDC</a> 和 <a class="el" href="_custom_class.html">自定义</a> USB 设备类连接到 USB 主机。</li>
<li>支持 <a class="el" href="_u_s_b__control__transfers.html">控制</a>，<a class="el" href="_u_s_b__interrupt__transfers.html">中断</a> 和 <a class="el" href="_u_s_b__bulk__transfers.html">批量</a> 传输类型。</li>
</ul>
<h2>RTE 组件</h2>
<p>下图显示了 RTE 组件与单片机的 USB 主机外设（USB 控制器）的关系。RTE 组件提供配置文件和用户代码模板。<b>配置文件</b> 配置 RTE 组件，硬件接口，内存资源和 USB 主机参数。<b>用户代码模板</b> 为实现对不同 USB 设备类的支持提供了框架。</p>
<div class="image">
<img src="usb_host_blocks_config_files.png" alt="usb_host_blocks_config_files.png"/>
<div class="caption">
USB 主机结构</div></div>
<h1><a class="anchor" id="Create_a_USB_Host_Application"></a>
创建一个 USB 主机应用程序</h1>
<p>创建用作 USB 主机的微控制器应用程序的步骤如下：</p>
<ol type="1">
<li>选择您的应用程序所需的 <a class="el" href="_u_s_b__host.html#RTE_Software_Component_Selection_USBH">RTE 组件</a>。</li>
<li><a class="el" href="_u_s_b__host.html#USB_Driver_Configuration_USBH">启用并配置 USB 主机驱动程序</a>。</li>
<li>配置将 USB 中间件连接到单片机 USB 外设的 <a class="el" href="_u_s_b__host.html#USB_Host_Configuration_USBH">USB 主机</a>。</li>
<li>根据 USB 主机组件的 <a class="el" href="usb_resource_requirements.html#usbh_res_req">资源需求</a> 配置 <a class="el" href="_u_s_b__host.html#usbh_system_resources">系统资源</a>。</li>
<li>配置连接的 <a class="el" href="_u_s_b__host.html#USB_Device_Class_Configuration_USBH">USB 设备</a> 的参数。</li>
<li>使用提供的代码模板来实现 <a class="el" href="_u_s_b__host.html#USBH_User_Code_Implementation">应用程序代码</a>，以支持各种 USB 设备类。</li>
<li>使用 USB 组件的内置机制 <a class="el" href="_u_s_b__host.html#usbh_debugging">调试</a> 您的应用程序。</li>
</ol>
<h2><a class="anchor" id="RTE_Software_Component_Selection_USBH"></a>
RTE 组件选择</h2>
<p>RTE 组件选择通过几个步骤完成：</p>
<ol type="1">
<li>来自 USB 组件：<ul>
<li>选择提供 USB 通信所需基本功能的 <b>USB:CORE</b>。</li>
<li>将 <b>USB:Host</b> 设置为'1'。这将创建一个 USB 主机与连接的 USB 设备进行通信。</li>
<li>选择 USB 类（HID / MSC / CDC / 自定义 类）所需的支持。例如，选择 <b>USB:Host:HID</b> 仅支持 HID 类设备。</li>
</ul>
</li>
<li>从驱动程序组件：<ul>
<li>选择适合您的应用的适当的 USB 主机驱动程序。</li>
</ul>
</li>
<li>从设备组件：<ul>
<li>根据验证输出可能需要其他设备特定的驱动程序。</li>
</ul>
</li>
<li>来自 CMSIS 组件：<ul>
<li>选择 <b>CMSIS:CORE</b> 为处理器提供核心接口。</li>
<li>选择适合 USB 组件所需的 <b>CMSIS:RTOS</b>。</li>
</ul>
</li>
</ol>
<div class="image">
<img src="USBH_RTE.png" alt="USBH_RTE.png"/>
<div class="caption">
RTE 组件选择</div></div>
<h2><a class="anchor" id="USB_Driver_Configuration_USBH"></a>
USB 驱动程序和控制器</h2>
<p>微控制器的 USB 主机驱动程序和 USB 控制器需要正确配置。特别是这意味着：</p>
<ul>
<li>在驱动程序组件下选择的 USB 主机驱动程序通常使用 <b>RTE_Device.h</b> 配置文件进行配置。虽然此文件提供了多个选项，但启用与此驱动程序相关的 USB 主机外设通常就足够了。某些微控制器可能需要与物理层接口（PHY），USB <b>VBUS</b> 电源和 <b>过流</b> 保护相关的设置。</li>
<li>微控制器的 USB 控制器通常需要特定的时钟设置。请参阅微控制器的用户指南以了解要求。或者，您可以复制为各种评估板提供的 USB 主机示例的设置。</li>
</ul>
<h2><a class="anchor" id="USB_Host_Configuration_USBH"></a>
USB 主机配置</h2>
<p><b>USBH_Config_<em>n</em>.c</b> 文件包含特定 USB 主机的其他设置：</p>
<ul>
<li>根据所选择的 USB 控制器设置 <b>驱动器号</b>。对于单个 USB 设备控制器，它将是 “0”。</li>
<li>一些微控制器可以使用不同的硬件 <b>控制器接口</b>。请查阅所选微控制器的用户指南以选择正确的设置。</li>
</ul>
<p>有关所有可用设置的详细列表，请参阅 <a class="el" href="group__usbh__core_functions__conf.html">配置</a>。</p>
<h2><a class="anchor" id="usbh_system_resources"></a>
系统资源配置</h2>
<p>为了正确操作，USB 主机组件需要一些系统配置设置。要求是：</p>
<ul>
<li>额外的 <b>512 字节</b> 的 <b>堆栈</b> 大小。这可以在设备的 <script>link_ext('startup_device');</script> 文件（<code>Stack_Size</code>）中进行配置。</li>
<li>USB 主机组件使用 CMSIS-RTOS 线程。根据实例的数量，您需要在 <script>link_ext('RTX-Conf-CM5');</script> 文件中配置其他设置。</li>
</ul>
<p>有关更多信息，请查看 USB 主机组件的 <a class="el" href="usb_resource_requirements.html#usbh_res_req">资源需求</a> 部分。</p>
<h2><a class="anchor" id="USB_Device_Class_Configuration_USBH"></a>
可连接的 USB 设备的配置</h2>
<p>在 <b>USBH_Config_HID.h</b>，<b>USBH_Config_MSC.h</b>，<b>USBH_Config_CDC.h</b> 或 <b>USBH_Config_CustomClass.h</b> 中，您可以指定 USB 主机将支持的并行 USB 设备的数量。这会影响应用程序中用于附加 USB 设备的内存量。<a class="el" href="_u_s_b__host__tutorial.html">USB 主机 示例</a> 显示如何配置 USB 主机以与不同的 HID，MSC 或 CDC 外围设备进行交互。</p>
<h2><a class="anchor" id="USBH_User_Code_Implementation"></a>
用户代码实现</h2>
 <script>link_ext('uv4_ca_sourcefiles');</script> 文件提供功能模板以支持 USB 主机上的各种 USB 设备类。USB 主机组件的 <a class="el" href="group__usbh___dev_class_functions.html">参考</a> 部分对可用功能进行了说明。这些例程可以适应微控制器应用的需求，以防需要不同的默认功能。</p>
<p>以下模板可用于 USB 主机组件：</p>
<table class="doxtable">
<tr>
<th>模板名称</th><th>用意</th></tr>
<tr>
<td>USBH_MSC.c</td><td>支持 MSC 设备的必需功能。该模板可以在 <a class="el" href="group__usbh__msc_functions.html#USBH_MSC_UCT">这里</a> 找到。</td></tr>
<tr>
<td>USBH_PL2303.c</td><td>所需功能支持 <a href="http://www.prolific.com.tw/us/ShowProduct.aspx?pcid=41&amp;showlevel=0017-0037-0041" class="el" target="_blank">Prolific PL2303</a> USB 至串行 RS232 适配器。该模板可以在 <a class="el" href="group__usbh__custom_functions.html#USBH_PL2303_UCT">这里</a> 找到。</td></tr>
<tr>
<td>USBH_User_CustomClass.c</td><td>所需的功能，以支持任何 USB 设备类。该模板可以在 <a class="el" href="group__usbh__custom_functions.html#USBH_Cust_UCT">这里</a> 找到。</td></tr>
</table>
<h2><a class="anchor" id="usbh_debugging"></a>
调试</h2>
<p>USB 主机组件以库的形式分发，不允许其直接代码调试。然而，它可以很容易地配置为生成调试事件并为组件操作提供动态可见性。</p>
<p>可以在 <b>Manage Run-Time Environment</b> 窗口中为 <b>USB:CORE</b> 软件组件选择以下变体：</p>
<ul>
<li><b>Debug</b>: 该变体支持 <script>link_ext('Event-Recorder-About');</script> 的事件注释，并且使得在应用程序调试过程中分析 USB 主机组件的内部操作变得非常简单。下面的 <a class="el" href="_u_s_b__host.html#usbHostEvrSupport">事件记录器支持</a> 介绍了如何配置和使用这个变体。</li>
<li><b>Release</b>: 这个变体不包含额外的调试代码。部署应用程序时使用此变体。</li>
</ul>
<p>下图显示了 <b>Debug</b> 版本的选择。</p>
<div class="image">
<img src="usbh_debug_variant.png" alt="usbh_debug_variant.png"/>
</div>
<p><a class="el" href="group__usbh__evr.html">USB Host:Debug Events</a> 描述 USB 设备组件中实现的事件。</p>
<p><a class="anchor" id="usbHostEvrSupport"></a></p>
<h2>事件记录器支持</h2>
 <script>link_ext('Event-Recorder-About');</script> 是一个强大的工具，可以提供程序动态执行的可视性。</p>
<p>USB 主机组件为事件记录器生成 <a class="el" href="group__usbh__evr.html">一系列广泛的调试事件</a>，并实现所需的基础设施以与其进行交互。</p>
<p>要使用事件记录器，需要创建具有事件生成支持的图像。必要的步骤是：</p>
<ol type="1">
<li> <script>link_ext('Debug-Variant-Select');</script>: 在 RTE 管理对话框中选择 <b>USB:CORE</b> 软件组件的 <b>Debug</b> 版本。</li>
<li> <script>link_ext('Event-Recorder-Enable');</script>: 在 RTE 管理对话框中启用软件组件 <b>Compiler:Event Recorder</b>。</li>
<li> <script>link_ext('Event-Recorder-Initialize');</script>: 在应用程序代码中，调用函数 <b>EventRecorderInitialize</b>。</li>
<li> <script>link_ext('Event-Recorder-Configure');</script>: 如有必要，调整默认的事件记录器配置。</li>
<li>构建应用程序代码，将其下载到目标硬件并启动调试会话。</li>
</ol>
<p>现在，当 USB 主机生成事件信息时，可以在 <script>link_ext('uv4-Event-Recorder');</script> 中查看它。</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">生成于 2018 年 2 月 21 日 星期三 适用于 ARM 有限公司的 USB 组件的所有权利。
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
