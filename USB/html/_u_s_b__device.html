<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>USB 设备</title>
<title>USB 组件：USB 设备</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">USB 组件
   &#160;<span id="projectnumber">版本 6.12.4</span>
   </div>
   <div id="projectbrief">用于 USB 设备和主机通信的 MDK 中间件</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>主&#160;页</span></a></li>
      <li class="current"><a href="pages.html"><span>用法&#160;和&#160;描述</span></a></li>
      <li><a href="modules.html"><span>参考</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_u_s_b__device.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全部</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>数据结构</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>函数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>变量</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>枚举</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>枚举</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>组</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>页面</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">USB 设备</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul><li class="level1"><a href="#Creation_Steps">创建一个 USB 设备应用程序</a><ul><li class="level2"><a href="#RTE_Software_Component_Selection">RTE 组件选择</a></li>
<li class="level2"><a href="#USB_Driver_Configuration">USB 驱动程序和控制器</a></li>
<li class="level2"><a href="#USB_Device_Configuration">USB 设备配置</a></li>
<li class="level2"><a href="#USB_Device_Class_Configuration">USB 设备类别配置和 USB 端点设置</a></li>
<li class="level2"><a href="#usbd_system_resources">系统资源配置</a></li>
<li class="level2"><a href="#User_Code_Implementation">用户代码实现</a></li>
<li class="level2"><a href="#Overriding_Descriptors">更改默认 USB 描述符</a></li>
<li class="level2"><a href="#usbd_debugging">调试</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>本章介绍 USB 设备组件的软件结构及其用于创建应用程序的用途。USB 设备组件简化了连接到 USB 主机的微控制器系统的软件开发。</p>
<p><b>USB 设备组件的属性：</b></p>
<ul>
<li>支持 <a class="el" href="_u_s_b__transfer__rates.html">低速</a>，<a class="el" href="_u_s_b__transfer__rates.html">全速</a> 和 <a class="el" href="_u_s_b__transfer__rates.html">高速</a>。</li>
<li>支持具有多个设备类实例的标准 <a class="el" href="_u_s_b__classes.html">USB 类</a>。</li>
<li>支持复合设备。结合 USB 设备类来创建一个 <a class="el" href="dev_comp_tutorial.html">复合设备</a>。</li>
<li>在具有多个 USB 设备控制器的单个微控制器上支持多个 USB 设备。</li>
<li>提供用于实现 USB 设备功能的 <script>link_ext('uv4_ca_sourcefiles');</script>。</li>
<li>为每个设备类提供一个用户友好的配置文件来生成 <a class="el" href="_u_s_b__descriptors.html">USB 描述符</a>。</li>
<li>灵活地将 <a class="el" href="_u_s_b__endpoints.html">USB 端点</a> 分配给微控制器 USB 设备外设。</li>
<li>提供 <a class="el" href="_u_s_b__device__tutorial.html">USB 设备示例</a> 以显示软件栈的使用。</li>
</ul>
<p>为了连接到 USB 主机，可能需要额外的软件。<a class="el" href="usb_sw_utilities.html">与 USB 主机的接口</a> 显示了在 Windows PC 上运行的这种软件的示例。</p>
<h2>RTE 组件</h2>
<p>图中显示了 RTE 组件和微控制器的 USB 设备外设（USB 控制器）之间的关系。RTE 组件提供配置文件和用户代码模板。<b>配置文件</b> 配置 RTE 组件，硬件接口，内存资源和 USB 设备驱动程序参数。它们可能对多个 RTE 组件产生影响（例如，RTE_Device.h 配置 USB 控制器 0 <em>和</em> Driver_USBD0）。<b>用户代码模板</b> 提供了实现 USB 设备功能的框架。</p>
<p>RTE 组件 USB 设备 1 和 Driver_USBD1 以及 USB 控制器 1 周围的灰色区域表示这些组件是可选的，并且只能在微控制器设备具有多个 USB 控制器的情况下使用。如果是这种情况，可以将 USB 设备类连接到任何 USB 设备实例。</p>
<div class="image">
<img src="usb_device_blocks_config_files.png" alt="usb_device_blocks_config_files.png"/>
<div class="caption">
USB 设备结构</div></div>
<p>USB 设备外设可以具有一个或多个以下 USB 设备类：</p>
<ul>
<li><a class="el" href="_a_d_c.html">音频设备类（ADC）</a>用于在 USB 主机和 USB 设备之间交换流音频数据。</li>
<li><a class="el" href="_c_d_c.html">通信设备类（CDC）</a>为 USB 主机提供虚拟通信端口功能。</li>
<li><a class="el" href="_h_i_d.html">人机接口设备（HID）</a>通常用于实现键盘，游戏杆或鼠标。HID 类别也可用于低带宽数据交换。</li>
<li><a class="el" href="_m_s_c.html">大容量存储类（MSC）</a>用于将各种存储设备连接到 USB 主机。大容量存储类媒体可以是 SD 卡，内部或外部闪存或 RAM。</li>
<li><a class="el" href="_custom_class.html">自定义类</a> 用于实现标准或供应商特定的 USB 设备类。</li>
</ul>
<p>关于 USB 设备类的通用信息可以在 UB-IF <a href="http://www.usb.org/developers/docs/devclass_docs/" class="el" target="_blank">批准的类别规范文件</a> 上找到。</p>
<p>多个 RTE 组件实例可以连接多个 USB 控制器，也可以实现多个 USB 设备类。RTE 组件实例编号。该编号附加到 RTE 组件名称，相关配置文件和用户代码模板。每个 RTE 组件都有一个单独的配置文件。例如，对于 HID 0 和 HID 1，配置文件的名称分别为 <b>USB_Config_HID_0.h</b> 和 <b>USB_Config_HID_1.h</b>。</p>
<dl class="section note"><dt>注意</dt><dd>默认配置设置是针对非复合设备外设中的 USB 设备或 USB 设备类的一个实例进行预配置的。对于其他组合，<em>需要</em> 对设置进行编辑以确保正确操作。<a class="el" href="dev_comp_tutorial.html">USB 复合设备</a> 示例显示如何实现和配置复合设备</dd></dl>
<h1><a class="anchor" id="Creation_Steps"></a>
创建一个 USB 设备应用程序</h1>
<p>创建使用与 USB 设备控制器的 USB 通信的微控制器应用程序的步骤如下：</p>
<ol type="1">
<li>选择 <a class="el" href="_u_s_b__device.html#RTE_Software_Component_Selection">RTE 组件</a> 以及应用程序所需的 USB 设备类。</li>
<li><a class="el" href="_u_s_b__device.html#USB_Driver_Configuration">启用并配置 USB 设备驱动程序</a>。</li>
<li>配置将 USB 中间件连接到单片机 USB 外设的 <a class="el" href="_u_s_b__device.html#USB_Device_Configuration">USB 设备</a>。</li>
<li>为每个选定的 USB 设备类别和实例配置 <a class="el" href="_u_s_b__device.html#USB_Device_Class_Configuration">USB 设备类别配置和 USB 端点设置</a>。</li>
<li>根据 USB 设备组件的 <a class="el" href="usb_resource_requirements.html#usbd_res_req">资源需求</a> 配置 <a class="el" href="_u_s_b__device.html#usbd_system_resources">系统资源</a>。</li>
<li>使用为 USB 设备类提供的代码模板实现 <a class="el" href="_u_s_b__device.html#User_Code_Implementation">应用程序代码</a>。</li>
<li>如果您的应用程序需要，您可以 <a class="el" href="_u_s_b__device.html#Overriding_Descriptors">更改默认的 USB 设备描述符</a>。</li>
<li>使用 USB 组件的内置机制 <a class="el" href="_u_s_b__device.html#usbd_debugging">调试</a> 您的应用程序。</li>
</ol>
<p>为了连接到 USB 主机，可以使用标准的 USB 设备类驱动程序。这可能需要 USB 主机应用程序的其他软件开发。<a class="el" href="usb_sw_utilities.html#hid_client_app">这里</a> 解释用于连接到 USB HID 设备的示例性应用。</p>
<h2><a class="anchor" id="RTE_Software_Component_Selection"></a>
RTE 组件选择</h2>
<p>只需几个步骤即可完成 RTE 组件选择：</p>
<ol type="1">
<li>来自 USB 组件：<ul>
<li>选择提供 USB 通信所需基本功能的 <b>USB:CORE</b>。</li>
<li>将 <b>USB:Device</b> 设置为 '1'。这将创建一个用于与 USB 主机进行通信的 USB 设备。</li>
<li>选择所需的 USB 类（HID，MSC，CDC，ADC 或自定义类）。例如，将 <b>USB:Device:HID</b> 设置为 '1' 以创建单个 HID 类设备。如果在同一设备上选择多个类或同一个类的多个实例，则将创建一个 <b>复合 USB 设备</b>。</li>
</ul>
</li>
<li>从驱动程序组件：<ul>
<li>选择适合您应用的适当 USB 设备驱动程序。</li>
</ul>
</li>
<li>从设备组件：<ul>
<li>根据验证输出可能需要其他设备特定的驱动程序。</li>
</ul>
</li>
<li>来自 CMSIS 组件：<ul>
<li>选择 <b>CMSIS:CORE</b> 为处理器提供核心接口。</li>
<li>选择适合 USB 组件所需的 <b>CMSIS:RTOS</b>。</li>
</ul>
</li>
</ol>
<div class="image">
<img src="rteusbx.png" alt="rteusbx.png"/>
<div class="caption">
RTE 组件选择</div></div>
 <dl class="section note"><dt>注意</dt><dd><ul>
<li>大多数微控制器只有一个 USB 控制器以硬件实现，并且只有一个驱动器 <b>Driver_USBD0</b> 可用。在这种情况下，只能选择一个 <b>USB:Device</b> 来生成 <b>USB 设备 0</b> 。</li>
<li>在单个 <b>USB 设备 0</b> 上，可以实现组合多个 USB 设备类的 USB 组合设备。</li>
<li>当一个微控制器实现多个 USB 控制器时，通过将 <b>USB:Device</b> 设置为 '2'，可以生成一个附加的 <b>USB 设备 1</b>。</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="USB_Driver_Configuration"></a>
USB 驱动程序和控制器</h2>
<p>微控制器的 USB 设备驱动程序和 USB 控制器需要正确配置。特别是这意味着：</p>
<ul>
<li><p class="startli">在驱动程序组件下选择的 USB 设备驱动程序通常使用 <b>RTE_Device.h</b> 配置文件进行配置。虽然此文件提供了多个选项，但启用与此驱动程序相关的 USB 设备外设通常就足够了。一些微控制器可能需要与物理层接口（PHY）相关的设置。下图显示了两种可能的变体。无论是 USB PHY 集成到控制器中，还是使用外部芯片来提供 USB 信号线：</p>
<div class="image">
<img src="usb_phy.png" alt="usb_phy.png"/>
<div class="caption">
USB 控制器和 PHY 设置</div></div>
</li>
<li>微控制器的 USB 控制器通常需要特定的时钟设置。请参阅微控制器的用户指南以了解要求。或者，您可以复制 USB 设备示例的设置（以防您的硬件设置与所选评估板的设置类似）。</li>
</ul>
<h2><a class="anchor" id="USB_Device_Configuration"></a>
USB 设备配置</h2>
<p>配置文件 <b>USBD_Config_<em>n</em>.c</b> 在组件 USB 下的项目窗口中列出，并包含特定 USB 设备的许多重要设置。</p>
<ul>
<li><b>Driver_USBD#</b> 号码根据所选 USB 控制器设置。这指定哪个驱动程序将用于确定引脚的 USB 设备。对于单个 USB 设备控制器，它将为 '0'。</li>
<li>如果 USB 控制器支持，可以选择 <b>高速</b>。</li>
<li><b>供应商 ID</b>（VID）需要设置为专用 VID。默认的供应商 ID 由 Keil 拥有，不得用于实际产品。有关如何申请有效的供应商 ID 的更多信息，请访问 <a href="http://www.usb.org/developers/vendor/" class="el" target="_blank">USB-IF</a>。</li>
<li>每个设备型号都需要一个唯一的 <b>产品 ID</b>。与 <b>VID</b> 一起，主机计算机的操作系统使用它来查找设备的驱动程序。</li>
<li><b>设备发行号码</b> 将在 Windows 和 Linux 系统中显示为 “固件版本”。该数字将被解释为 “二进制编码的十进制”，这意味着 0x0101 将显示为固件版本 1.01。</li>
<li><b>制造商</b>，<b>产品</b> 和 <b>序列号字符串</b> 可以设置为识别 USB 主机上的 USB 设备。</li>
</ul>
<p>有关 USB 设备的更多配置选项，请参阅 <a class="el" href="group__usbd__core_functions__conf.html">USB 核心配置</a>。</p>
<dl class="section note"><dt>注意</dt><dd>您可以使用 <a class="el" href="group__usbd__core_functions__api.html">USB 设备核心 API</a> 中的功能在运行时配置 USB 设备。<a class="el" href="group__usbd__core_functions.html">USB 设备核心</a> 一节介绍了详细信息。使用用户代码模板 <a class="el" href="group__usbd__class_functions.html#USBD_User_Device_UCT">USBD_User_Device_n.c</a> 实现特定于运行时的行为。</dd></dl>
<h2><a class="anchor" id="USB_Device_Class_Configuration"></a>
USB 设备类别配置和 USB 端点设置</h2>
<p>USB 设备类别参数和端点设置在每个 USB 设备类别的单独文件中配置，并针对每个实例分别配置配置文件包含设备类特定的端点设置编号，并列在组件 USB 下的项目窗口中。</p>
<ul>
<li><b>USBD_Config_ADC_<em>n</em>.h</b> 音频设备类（ADC）的配置。</li>
<li><b>USBD_Config_CDC_<em>n</em>.h</b> 通信设备类（CDC）的配置。</li>
<li><b>USBD_Config_HID_<em>n</em>.h</b> 人机接口设备类（HID）的配置。</li>
<li><b>USBD_Config_MSC_<em>n</em>.h</b> 大容量存储设备类（MSC）的配置。</li>
<li><b>USBD_Config_CustomClass_<em>n</em>.h</b> 自定义类的配置。</li>
</ul>
<p>每个 <a class="el" href="_u_s_b__endpoints.html">USB 端点</a> 只能在同一个 USB 设备上使用一次。必须确保不同的 USB 设备类或相同 USB 设备类的多个实例使用不同的端点。默认配置支持使用单个 USB 设备类的应用程序。其余参数是用于配置 USB 通信速度和 USB 设备类的参数的特定设置。</p>
<h2><a class="anchor" id="usbd_system_resources"></a>
系统资源配置</h2>
<p>为了正确操作，USB 设备组件需要一些系统配置设置。要求是：</p>
<ul>
<li>额外的 <b>512 字节</b> 的 <b>堆栈</b> 大小。这可以在设备的 <script>link_ext('startup_device');</script> 文件（<code>Stack_Size</code>）中进行配置。</li>
<li>USB 设备组件使用 CMSIS-RTOS 线程。根据支持的 USB 设备类的数量，您需要在 <script>link_ext('RTX-Conf-CM5');</script> 文件中配置其他设置。</li>
</ul>
<p>有关更多信息，请查看 USB 设备组件的 <a class="el" href="usb_resource_requirements.html#usbd_res_req">资源需求</a> 部分。</p>
<h2><a class="anchor" id="User_Code_Implementation"></a>
用户代码实现</h2>
 <script>link_ext('uv4_ca_sourcefiles');</script> 文件提供用于实现 USB 设备类功能的功能模板。USB 组件的 <a class="el" href="group__usbd___dev_class_functions.html">参考</a> 部分对可用功能进行了说明。这些例程可以适应微控制器应用的需求，以防需要不同的默认功能。</p>
<p>以下模板可用于 USB 设备组件：</p>
<table class="doxtable">
<tr>
<th>模板名称</th><th>用意</th></tr>
<tr>
<td><a class="el" href="group__usbd__adc_functions.html#USBD_User_ADC_UCT">USBD_User_ADC_n.c</a> </td><td>创建 ADC 设备所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__cdc_functions__acm.html#USBD_User_CDC_ACM_UCT">USBD_User_CDC_ACM_n.c</a> </td><td>创建 CDC（ACM）设备所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__cdc_functions__acm.html#USBD_User_CDC_ACM_UART_UCT">USBD_User_CDC_ACM_UART_n.c</a> </td><td>用于创建演示 USB &lt;-&gt; UART 桥的 CDC（ACM）器件的必需功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__cdc_functions__acm.html#USBD_User_CDC_ACM_UCT">USBD_User_CDC_NCM_n.c</a> </td><td>创建 CDC（NCM）设备所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__cdc_functions__acm.html#USBD_User_CDC_ACM_UCT">USBD_User_CDC_NCM_ETH_n.c</a> </td><td>创建 CDC（NCM）设备所需的功能（通过 USB 的以太网）。 </td></tr>
<tr>
<td><a class="el" href="group__usbd__class_functions.html#USBD_User_Cust_UCT">USBD_User_CustomClass_n.c</a> </td><td>创建支持自定义 USB 设备类的设备所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__class_functions.html#USBD_User_Device_UCT">USBD_User_Device_n.c</a> </td><td>USB 设备运行时配置所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__core_functions.html#USBD_User_Device_SerNum_UCT">USBD_User_SerNum_n.c</a> </td><td>运行时配置示例：更改 USB 设备的序列号。</td></tr>
<tr>
<td><a class="el" href="group__usbd__hid_functions.html#USBD_User_HID_UCT">USBD_User_HID_n.c</a> </td><td>创建 HID 设备所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__hid_functions.html#USBD_User_HID_Mouse_UCT">USBD_User_HID_Mouse_n.c</a> </td><td>实现功能来创建充当鼠标指针输入设备的 USB HID 设备。</td></tr>
<tr>
<td><a class="el" href="group__usbd__msc_functions.html#USBD_User_MSC_UCT">USBD_User_MSC_n.c</a> </td><td>创建 MSC 设备所需的功能。</td></tr>
<tr>
<td><a class="el" href="group__usbd__msc_functions.html#USBD_MSC_UCT">USBD_MSC_n.c</a> </td><td>演示如何从应用程序/文件系统或 USB 主机访问存储介质。</td></tr>
</table>
<h2><a class="anchor" id="Overriding_Descriptors"></a>
更改默认 USB 描述符</h2>
<p>如果 <a class="el" href="_u_s_b__descriptors.html">USB 描述符</a> 的要求不同于 USB 组件，则用户可以更改任何或全部默认的 USB 描述符。默认描述符是库根据 <a class="el" href="_u_s_b__device.html#USB_Device_Configuration">设备</a> 和 <a class="el" href="_u_s_b__device.html#USB_Device_Class_Configuration">类</a> 配置文件设置创建的位于代码存储器中的描述符。</p>
<p>描述符可以通过以下两种方式进行更改：</p>
<ul>
<li><b>静态变化</b></li>
</ul>
<p>如果描述符不会在运行时更改，则可以完成描述符的静态更改以替换默认描述符。通过创建具有相同名称的描述符，用户代码可以轻松地覆盖描述符。</p>
<table class="doxtable">
<tr>
<th>USB 设备描述符 </th><th>用意</th></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_ep0_descriptor</code>[] </td><td>控制端点 0 描述符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_device_descriptor</code>[] </td><td>USB 设备描述符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_string_descriptor</code>[] </td><td>字符串描述符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_device_qualifier_fs</code>[] </td><td>低/全速设备限定符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_device_qualifier_hs</code>[] </td><td>高速设备限定符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_config_descriptor_fs</code>[] </td><td>低/全速的配置描述符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_config_descriptor_hs</code>[] </td><td>高速配置描述符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_other_speed_config_descriptor_fs</code>[] </td><td>低速/全速的其他速度配置描述符</td></tr>
<tr>
<td><code>const</code> <code>uint8_t</code> <code>usbdn_other_speed_config_descriptor_hs</code>[] </td><td>其他速度配置描述符用于高速</td></tr>
</table>
<dl class="section note"><dt>注意</dt><dd><ul>
<li><code>usbdn_</code> 中的 <code>n</code> 表示 USB 设备实例。因此，对于 USB 设备 0 实例，您必须使用 <code>usbd0_</code>...</li>
</ul>
</dd></dl>
<p><b>代码示例</b></p>
<div class="fragment"><div class="line"><span class="comment">// Statically change USB Device 0 Device Descriptor</span></div>
<div class="line"><span class="keyword">const</span> uint8_t usbd0_device_descriptor[] = { </div>
<div class="line">  18U,         <span class="comment">// bLength = 7 bytes</span></div>
<div class="line">  1U,          <span class="comment">// bDescriptorType = 1 = Device Descriptor Type</span></div>
<div class="line">  0U,2U,       <span class="comment">// bcdUSB = 2.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceSubClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceProtocol = 0 = Defined in interface</span></div>
<div class="line">  64U,         <span class="comment">// bMaxPacketSize = 64</span></div>
<div class="line">  0x51U,0xC2U, <span class="comment">// idVendor = 0xC251 (little-endian)</span></div>
<div class="line">  0x34U,0x12U, <span class="comment">// idProduct = 0x1234 (little-endian)</span></div>
<div class="line">  0U,1U,       <span class="comment">// bcdDevice = 1.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// iManufacturer = 0 = No Manufacturer string</span></div>
<div class="line">  0U,          <span class="comment">// iProduct = 0 = No Product string</span></div>
<div class="line">  0U,          <span class="comment">// iSerialNumber = 0 = No Serial Number string</span></div>
<div class="line">  1U           <span class="comment">// bNumConfigurations = 1 = 1 configuration</span></div>
<div class="line">};</div>
</div><!-- fragment --><ul>
<li><b>动态变化</b></li>
</ul>
<p>描述符的动态变化可以在运行时改变描述符。<code>struct</code> <b>usbd_desc_t</b> 包含所需的信息。它存储在 RAM 中，并包含指向 USB 描述符的指针。如果将结构中的指针更改为外部创建的指针，则可以在运行时更改描述符。</p>
<p>保存描述符指针的结构的实际变量名是 <code>usbdn_desc</code>（n 表示 USB 设备实例号）。以下代码示例显示如何覆盖 <b>USB 设备 0</b>（<code>usbd0_desc</code>）的设备描述符：</p>
<p><b>代码示例</b> </p>
<div class="fragment"><div class="line"><span class="comment">// Dynamically change USB Device 0 Device Descriptor</span></div>
<div class="line"><span class="keyword">const</span> uint8_t dev0_device_descriptor[] = { </div>
<div class="line">  18U,         <span class="comment">// bLength = 7 bytes</span></div>
<div class="line">  1U,          <span class="comment">// bDescriptorType = 1 = Device Descriptor Type</span></div>
<div class="line">  0U,2U,       <span class="comment">// bcdUSB = 2.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceSubClass = 0 = Defined in interface</span></div>
<div class="line">  0U,          <span class="comment">// bDeviceProtocol = 0 = Defined in interface</span></div>
<div class="line">  64U,         <span class="comment">// bMaxPacketSize = 64</span></div>
<div class="line">  0x51U,0xC2U, <span class="comment">// idVendor = 0xC251 (little-endian)</span></div>
<div class="line">  0x34U,0x12U, <span class="comment">// idProduct = 0x1234 (little-endian)</span></div>
<div class="line">  0U,1U,       <span class="comment">// bcdDevice = 1.00 (little-endian)</span></div>
<div class="line">  0U,          <span class="comment">// iManufacturer = 0 = No Manufacturer string</span></div>
<div class="line">  0U,          <span class="comment">// iProduct = 0 = No Product string</span></div>
<div class="line">  0U,          <span class="comment">// iSerialNumber = 0 = No Serial Number string</span></div>
<div class="line">  1U           <span class="comment">// bNumConfigurations = 1 = 1 configuration</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> usbd_desc_t usbd0_desc;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line">usbd0_desc.device_descriptor = (uint8_t *)dev0_device_descriptor;</div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>注意</dt><dd>仅更改序列号字符串使用函数 <a class="el" href="group__usbd__core_functions__api.html#ga3ccf0ff5b34716f104e3891158b5c6d6">USBD_SetSerialNumber</a> ！</dd>
<dd>
对于非高速设备，以下描述符并不重要：<ul>
<li><a class="el" href="_u_s_b__device__qualifier__descriptor.html">设备限定符描述符</a> 用于低/全速</li>
<li><a class="el" href="_u_s_b__device__qualifier__descriptor.html">设备限定符描述符</a> 用于高速</li>
<li>低/全速 <a class="el" href="_u_s_b__configuration__descriptor.html">配置描述符</a></li>
<li>高速 <a class="el" href="_u_s_b__configuration__descriptor.html">配置描述符</a></li>
<li>低速/全速的其他速度 <a class="el" href="_u_s_b__configuration__descriptor.html">配置描述符</a></li>
<li>高速的其他速度 <a class="el" href="_u_s_b__configuration__descriptor.html">配置描述符</a></li>
</ul>
</dd></dl>
<h2><a class="anchor" id="usbd_debugging"></a>
调试</h2>
<p>USB 设备组件以库的形式分发，不允许直接调试代码。然而，它可以很容易地配置为生成调试事件并为组件操作提供动态可见性。</p>
<p>可以在 <b>Manage Run-Time Environment</b> 窗口中为 <b>USB:CORE</b> 组件选择以下变体：</p>
<ul>
<li><b>Debug</b>: 该变体支持 <script>link_ext('Event-Recorder-About');</script> 的事件注释，并且使应用程序调试期间分析 USB 设备组件的内部操作变得非常简单。下面的 <a class="el" href="_u_s_b__device.html#usbDevEvrSupport">事件记录器支持</a> 介绍了如何配置和使用这个变体。</li>
<li><b>Release</b>: 这个变体不包含额外的调试代码。部署应用程序时使用此变体。</li>
</ul>
<p>下图显示了 <b>Debug</b> 版本的选择。</p>
<div class="image">
<img src="usbd_debug_variant.png" alt="usbd_debug_variant.png"/>
</div>
<p><a class="el" href="group__usbd__evr.html">USB Device:Debug Events</a> 描述 USB 设备组件中实现的事件。</p>
<p><a class="anchor" id="usbDevEvrSupport"></a></p>
<h2>事件记录器支持</h2>
 <script>link_ext('Event-Recorder-About');</script> 是一个强大的工具，可以提供程序动态执行的可视性。</p>
<p>USB 设备组件为事件记录器生成 <a class="el" href="group__usbd__evr.html">一系列广泛的调试事件</a>，并实现所需的基础设施以与其进行交互。</p>
<p>要使用事件记录器，需要创建具有事件生成支持的图像。必要的步骤是：</p>
<ol type="1">
<li> <script>link_ext('Debug-Variant-Select');</script>: 在 RTE 管理对话框中选择 <b>USB:CORE</b> 软件组件的 <b>Debug</b> 版本。</li>
<li> <script>link_ext('Event-Recorder-Enable');</script>: 在 RTE 管理对话框中启用软件组件 <b>Compiler:Event Recorder</b>。</li>
<li> <script>link_ext('Event-Recorder-Initialize');</script>: 在应用程序代码中，调用函数 <b>EventRecorderInitialize</b>。</li>
<li> <script>link_ext('Event-Recorder-Configure');</script>: 如有必要，调整默认的事件记录器配置。</li>
<li>构建应用程序代码，将其下载到目标硬件并启动调试会话。</li>
</ol>
<p>现在，当 USB 设备生成事件信息时，可以在 <script>link_ext('uv4-Event-Recorder');</script> 中查看它。</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">生成于 2018 年 2 月 21 日 星期三 适用于 ARM 有限公司的 USB 组件的所有权利。
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
