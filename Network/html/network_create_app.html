<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Creating a Network Application</title>
<title>Network Component: Creating a Network Application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<script type="text/javascript" src="URL_keys.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Network Component
   &#160;<span id="projectnumber">Version 7.8.0</span>
   </div>
   <div id="projectbrief">MDK Middleware for IPv4 and IPv6 Networking</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('network_create_app.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Creating a Network Application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The steps to create a microcontroller application that uses TCP/IP communication are:</p>
<ol type="1">
<li>Select <a class="el" href="network_create_app.html#nw_RTE_Software_Component_Selection">RTE Components</a> along with the Network Services that are required for your application.</li>
<li><a class="el" href="network_create_app.html#nw_Driver_Configuration">Enable the Network Driver and Controller</a> that is integrated in the microcontroller.</li>
<li>Configure the various <a class="el" href="network_create_app.html#nw_Device_Configuration">Network Components</a>.</li>
<li>Configure the <a class="el" href="network_create_app.html#nw_system_resources">system resources</a> according to the network component's <a class="el" href="nw_resource_requirements.html">Resource Requirements</a>.</li>
<li>Implement the <a class="el" href="network_create_app.html#nw_User_Code_Implementation">User Code</a> using code templates that are provided for the Network Component.</li>
<li><a class="el" href="network_create_app.html#nw_debugging">Debug</a> your application using the built-in mechanisms of the Network Component.</li>
<li>Sometimes, it is necessary to change some network settings at <a class="el" href="network_create_app.html#nw_runtime_config">runtime</a>.</li>
</ol>
<h1><a class="anchor" id="nw_RTE_Software_Component_Selection"></a>
RTE Component Selection</h1>
<p>Only a few steps are necessary to complete the RTE Component selection:</p>
<ol type="1">
<li>From the <b>Network</b> Component:<ul>
<li>Select <b>Network:CORE</b> that provides the basic functionality required for TCP/IP communication. Note that users of MDK-Professional can select between an IPv4/IPv6 dual-stack and an IPv4-only implementation, while users of MDK-Plus can only select the IPv4 implementation.</li>
<li>Select your desired <b>Network:Interface</b>. For example, set <b>Network:Interface:Ethernet</b> to '1' for enabling Ethernet communication.</li>
<li>Select the desired Network Services. For example, select <b>Network:Service:Web Server Compact</b> to create a simple Web Server.</li>
<li>Select the desired Network Sockets. For example, select <b>Network:Socket:TCP</b> for TCP communication. Usually, you will also select <b>Network:Socket:UDP</b> for stateless communication.</li>
</ul>
</li>
<li>From the <b>CMSIS Driver</b> Component:<ul>
<li>If you do Ethernet communication, select appropriate <b>CMSIS Driver:Ethernet (API)</b> or <b>CMSIS Driver:Ethernet MAC (API)</b> <em>and</em> <b>CMSIS Driver:Ethernet PHY (API)</b> drivers suitable for your application. For PPP or SLIP communication simply select <b>CMSIS Driver:USART (API):USART</b>.</li>
</ul>
</li>
<li>From the <b>Device</b> Component:<ul>
<li>Additional device specific drivers may be required according to the validation output.</li>
</ul>
</li>
<li>From the <b>CMSIS</b> Component:<ul>
<li>Select the <b>CMSIS:CORE</b> to provide the core interface to the processor.</li>
<li>Select a suitable <b>CMSIS:RTOS</b> that is a required for the Networking Component.</li>
</ul>
</li>
<li>If you need to <a class="el" href="secure_communication.html">secure the communication</a>, select from the <b>Security</b> Component:<ul>
<li><b>mbed</b> <b>TLS</b> </li>
</ul>
</li>
</ol>
<div class="image">
<img src="nw_rte_comp_selection.png" alt="nw_rte_comp_selection.png"/>
<div class="caption">
RTE Component Selection Example</div></div>
 <h1><a class="anchor" id="nw_Driver_Configuration"></a>
Network Driver and Controller Configuration</h1>
<p>The Network Device Driver and the Network Controller of the microcontroller need to be correctly configured. This means:</p>
<ul>
<li>The <a class="el" href="group__net_e_t_h___func.html">Ethernet interface</a> or <b>UART</b> (for <a class="el" href="group__net_s_l_i_p___func.html">SLIP</a>/<a class="el" href="group__net_p_p_p___func.html">PPP</a>) is typically configured in the <b>RTE_Device.h</b> configuration file. While this file provides multiple options, it is typically sufficient to enable the Ethernet/UART interface. <b>Note:</b> Some microcontrollers may require settings that are related to a physical layer interface (PHY).</li>
<li>The Network Controller of the microcontroller typically needs specific clock settings. Consult the user's guide of the microcontroller to understand the requirements. Alternatively, you may copy the setup of an <a class="el" href="nw_examples.html">example project</a> that is provided for various evaluation boards.</li>
</ul>
<h1><a class="anchor" id="nw_PHY_Configuration"></a>
Ethernet PHY Configuration</h1>
<p>For Ethernet network communication, usually an external Ethernet PHY is required to interface the physical line to the digital MAC of the microcontroller device. The MAC usually contains two buses:</p>
<ol type="1">
<li>Data bus: <a href="https://en.wikipedia.org/wiki/Media-independent_interface" target="_blank">MII, RMII,</a> or Serial Network Interface (SNI)</li>
<li>Management bus: Serial Management Interface (<b>SMI</b>) (using MDC and MDIO)</li>
</ol>
<p>SMI is used to access the PHY’s internal registers to read the state of the link (up/down), duplex mode, speed, and to restart auto-negotiation etc. SMI is a serial bus, which allows to connect up to 32 devices. Devices on the bus are accessed using a 5-bit device address. A default device address is hardware configurable by pin-strapping on the device (some pins are sampled when a reset is asserted or at power-up).</p>
<p>The device’s internal weak pull-up or pull-down resistors define a default device address. This address can be changed by connecting strong pull-up or pull-down resistors externally. In this case, the <code>ETH_PHY_ADDR</code> in the PHY driver needs to be changed accordingly to be able to control the PHY and to communicate with it. Use the <b>Options for Component</b> dialog to override the default setting for <code>ETH_PHY_ADDR:</code> </p>
<div class="image">
<img src="eth_phy_config.png" alt="eth_phy_config.png"/>
</div>
<h1><a class="anchor" id="nw_Device_Configuration"></a>
Network Configuration</h1>
<p>All configuration files for the Network Component are listed in the Project window below the Component Class <b>Network</b>.</p>
<h2>Network Core </h2>
<div class="image">
<img src="net_config_c.png" alt="net_config_c.png"/>
<div class="caption">
Net_Config.c Configuration File</div></div>
<p> The Network Core configuration file <b>Net_Config.c</b> contains the setting for the <b>Local Host Name</b>. This is a name under which the network device can be accessed on a local area network (<b>LAN</b>). This requires a <a class="el" href="group__using__ethernet__interfaces__conf.html">NetBIOS Name Service</a> to be enabled in the configuration. This name is very useful if you don't know the IP address that has been assigned to your device by the DHCP server.</p>
<p>The <b>Memory Pool Size</b> specifies the amount of RAM in bytes allocated for the memory pool. The buffers for the network packets are allocated from this memory pool. Usually, the default value of 12000 bytes is sufficient.</p>
<p>Many <a class="el" href="group__net_services.html">Network Services</a> are started by the Network Core automatically. If you disable <b>Start System Service</b>, you need to enable/start them at runtime using the dedicated functions for that.</p>
<p>To change the default OS resource settings for the Network Core, use <b>Core Thread Stack Size</b>. The default value is 1024 bytes.</p>
<h2>Network Interface </h2>
<p>The Network Interface configuration files <b>Net_Config_<em>Interface</em>_<em>n</em>.h</b> contain general IP address and other settings. You also need to specify the hardware driver number that is to be used with the network interface. In case of Ethernet for example, this is usually 0. If you are using a SLIP or PPP over a serial connection, you need to specify the hardware driver number of the exact UART you wish to use. All settings for the different interfaces are described here:</p>
<ul>
<li><a class="el" href="group__using__ethernet__interfaces__conf.html">Net_Config_ETH_0.h</a></li>
<li><a class="el" href="group__using__ppp__interfaces__conf.html">Net_Config_PPP.h</a></li>
<li><a class="el" href="group__using__slip__interfaces__conf.html">Net_Config_SLIP.h</a></li>
</ul>
<h2>Network Socket </h2>
<p>Usually, the needs of most applications are served by using the default settings for the sockets. Of course, there are configuration files for all three socket types that are specified in</p>
<ul>
<li><a class="el" href="group__using__network__sockets__bsd__conf.html">Net_Config_BSD.h</a></li>
<li><a class="el" href="group__using__network__sockets__tcp__conf.html">Net_Config_TCP.h</a></li>
<li><a class="el" href="group__using__network__sockets__udp__conf.html">Net_Config_UDP.h</a></li>
</ul>
<h2>Network Service </h2>
<p>The configuration files for all the Network Services are explained in the respective section:</p>
<ul>
<li><a class="el" href="group__ws__configuration.html">Net_Config_HTTP_Server.h</a></li>
<li><a class="el" href="group__using__ftp__server__conf.html">Net_Config_FTP_Server.h</a></li>
<li><a class="el" href="group__using__ftpc__conf.html">Net_Config_FTP_Client.h</a></li>
<li><a class="el" href="group__using__tftp__server__conf.html">Net_Config_TFTP_Server.h</a></li>
<li><a class="el" href="group__using__tftpc__conf.html">Net_Config_TFTP_Client.h</a></li>
<li><a class="el" href="group__telnet__server__conf.html">Net_Config_Telnet_Server.h</a></li>
<li><a class="el" href="group__using__snmp__agent__conf.html">Net_Config_SNMP_Agent.h</a></li>
<li><a class="el" href="group__using__dns__client__conf.html">Net_Config_DNS_Client.h</a></li>
<li><a class="el" href="group__using__sntp__client__conf.html">Net_Config_SNTP_Client.h</a></li>
<li><a class="el" href="group__using__smtpc__conf.html">Net_Config_SMTP_Client.h</a></li>
</ul>
<h1><a class="anchor" id="nw_security_config"></a>
Security Configuration</h1>
<p>The <b>mbed</b> <b>TLS</b> component provides an API for <a class="el" href="secure_communication.html">secure communication</a>. When selecting this software component, the <b>mbedTLS_config.h</b> configuration file is added to the project. The proper usage of this file is out of the scope of this document. For further information, check the online documentation of  <script>link_ext('mbedTLS');</script>.</p>
<h1><a class="anchor" id="nw_system_resources"></a>
System Resource Configuration</h1>
<p>For proper operation, the Network Component requires some system configuration settings. The requirements are:</p>
<ul>
<li>Additional <b>stack</b> size of <b>512 bytes</b>. This can be configured in the device's <script>link_ext('startup_device');</script> file (<code>Stack_Size</code>).</li>
<li>The Network Component uses two CMSIS-RTOS threads <code>netCore_Thread</code> and <code>netETH_Thread</code> when Ethernet Interface is enabled. So you need to increase the <b>Number of concurrent running threads</b> by 2. The default thread stack size should be at least <b>512 Bytes</b>. Also, <b>User Timers</b> need to be enabled.</li>
</ul>
<p>All these changes must be done in the <script>link_ext('RTX-Conf-CM5');</script> file. For more information, check the Network Component's <a class="el" href="nw_resource_requirements.html">Resource Requirements</a> section.</p>
<h1><a class="anchor" id="nw_User_Code_Implementation"></a>
User Code Implementation</h1>
 <script>link_ext('uv4_user_code_template');</script> files provide access to all functions that are required to communicate over the Network. The available functions are explained in the <a href="./modules.html" class="el">Reference</a> section of the Network Component. These routines can be adapted to the needs of the microcontroller application, in case more functionality is needed.</p>
<p>The following templates are available for the Network component: </p>
<table class="doxtable">
<tr>
<th>Template Name</th><th>User Functions  </th></tr>
<tr>
<td>DNS_Client.c </td><td><code>dns_cbfunc</code> (Callback function for notification about DNS client events), <code>resolve_host</code> (DNS resolving process) </td></tr>
<tr>
<td>FTP_Client_UIF.c </td><td><a class="el" href="group__ftpc__operation.html#ga2d45d1e964d8960971fb852b45f4cdf8">netFTPc_Process</a> (Request parameters for FTP client session), <a class="el" href="group__ftpc__operation.html#ga6c61683ecd364f193ceebd3aa6974288">netFTPc_Notify</a> (Notify the user application when FTP client operation ends) </td></tr>
<tr>
<td>FTP_Server_Access.c </td><td><a class="el" href="group__ftp__access__filter__mui.html#ga38c2ff05058bdb0ca8b3c122bffc4bb9">netFTPs_AcceptClient</a> (Accept or deny connection from remote FTP client) </td></tr>
<tr>
<td>FTP_Server_Event.c </td><td><a class="el" href="group__ftp__user__notification.html#ga32dd710872b1d0a7d244af76f942d807">netFTPs_Notify</a> (Notify the user application about events in FTP server service) </td></tr>
<tr>
<td>FTP_Server_Multiuser.c </td><td><a class="el" href="group__ftp__access__filter__mui.html#gab204f191fe2ed707562ca0246dab0617">netFTPs_CheckUsername</a> (Check if an user account exists), <a class="el" href="group__ftp__access__filter__mui.html#ga100ca730f5e9e891ede74caf51d0ce3a">netFTPs_CheckPassword</a> (Check user account password), <a class="el" href="group__ftp__access__filter__mui.html#ga946cfca1047c9d91737ba310ba4f2238">netFTPs_FileAccess</a> (Check if remote user is allowed to access a file) </td></tr>
<tr>
<td>HTTP_Server_Access.c </td><td><a class="el" href="group__ws__access__filtering__mui.html#gaf36a37f99a76e8ca958fbde377cee73d">netHTTPs_AcceptClient</a> (Accept or deny connection from remote HTTP client) </td></tr>
<tr>
<td>HTTP_Server_CGI.c </td><td><a class="el" href="group__ws__cgi__script.html#ga7d01432d1adc6a5a0e21eacd82d55910">netCGI_ProcessQuery</a> (Process query string received by GET request), <a class="el" href="group__ws__cgi__script.html#gafa3ddab948908d6fd4926fe3a3da06e9">netCGI_ProcessData</a> (Process data received by POST request), <a class="el" href="group__ws__cgi__script.html#ga5203e3a1a0f95a8b76fb83bec73e4be8">netCGI_Script</a> (Generate dynamic web data from a script line) </td></tr>
<tr>
<td>HTTP_Server_Error.c </td><td><code>net_http_error</code> (Define user-friendly HTTP error messages) </td></tr>
<tr>
<td>HTTP_Server_Multiuser.c </td><td><a class="el" href="group__ws__access__filtering__mui.html#gaee074414cedf60bc3d259f6647d67e0d">netHTTPs_CheckAccount</a> (Check if an user account exists), <a class="el" href="group__ws__access__filtering__mui.html#ga5844644be087d719f4d4f7e7e92993e4">netHTTPs_FileAccess</a> (Check if remote user is allowed to access a file) </td></tr>
<tr>
<td>SMTP_Client_UIF.c </td><td><a class="el" href="group__smtpc__operation.html#ga9f299f586e428d9a005c1ca9668fd7b3">netSMTPc_Process</a> (Request parameters for SMTP client session), <a class="el" href="group__smtpc__operation.html#ga5240c89a181c1ddb07bbe888a6a8657f">netSMTPc_Notify</a> (Notify the user application when SMTP client operation ends), <a class="el" href="group__smtpc__operation.html#ga58a7a56c6bda480e21591ee33c028aa5">netSMTPc_AcceptAuthentication</a> (Accept or deny authentication requested by SMTP server) </td></tr>
<tr>
<td>SNMP_Agent_MIB.c </td><td><code>mib_table</code> (Defines MIB information data table), <code>register_mib_table</code> (Registers a MIB table in SNMP agent) </td></tr>
<tr>
<td>TCP_Socket_Client.c </td><td><code>tcp_cb_client</code> (Notify the user application about TCP socket events), <code>send_data</code> (Connect to TCP server and send data) </td></tr>
<tr>
<td>TCP_Socket_Server.c </td><td><code>tcp_cb_server</code> (Notify the user application about TCP socket events) </td></tr>
<tr>
<td>Telnet_Server_Access.c </td><td><a class="el" href="group__telnet__access__filter__mui.html#ga3ec99f8332f7734909fb66808daca8f4">netTELNETs_AcceptClient</a> (Accept or deny connection from remote Telnet client) </td></tr>
<tr>
<td>Telnet_Server_Multiuser.c </td><td><a class="el" href="group__telnet__access__filter__mui.html#ga73d0d9e1ca34deaef1a4d0ae60e4f899">netTELNETs_CheckUsername</a> (Check if an user account exists), <a class="el" href="group__telnet__access__filter__mui.html#ga2ce267a4349c5723e02eee6e22149bb8">netTELNETs_CheckPassword</a> (Check user account password) </td></tr>
<tr>
<td>Telnet_Server_UIF.c </td><td><a class="el" href="group__telnet__user__notification.html#ga66dbef28a03b6885922151c38bf3b0e2">netTELNETs_ProcessMessage</a> (Request message for Telnet server session), <a class="el" href="group__telnet__user__notification.html#gae28cb4a796ee5e59ad5e32dccc969c76">netTELNETs_ProcessCommand</a> (Process a command and generate response) </td></tr>
<tr>
<td>TFTP_Client_UIF.c </td><td><code>tftp_client_notify</code> (Notify the user application when TFTP client operation ends) </td></tr>
<tr>
<td>TFTP_Server_Access.c </td><td><a class="el" href="group__tftp__server__access.html#gab05c8ba4e93e67235ca3ac5e955288f4">netTFTPs_AcceptClient</a> (Accept or deny connection from remote TFTP client) </td></tr>
<tr>
<td>UDP_Socket.c </td><td><code>udp_cb_func</code> (Notify the user application about UDP socket events), <code>send_udp_data</code> (Send UDP data to destination client) </td></tr>
</table>
<h1><a class="anchor" id="nw_debugging"></a>
Debugging</h1>
<p>The Network Component is distributed in library form and doesn't allow direct code debug. However, it can be configured to generate debug events and provide dynamic visibility to the component operation.</p>
<p>The following variants can be selected for the <b>Network:Core</b> component in the <b>Manage Run-Time Environment</b> window:</p>
<ul>
<li><a class="el" href="network_create_app.html#netEvrSupport">Debug</a>: this variant supports event annotations for the <script>link_ext('Event-Recorder-About');</script> and makes it very easy to analyze the internal operation of the Network Component during application debug.</li>
<li><a class="el" href="network_create_app.html#netDebugStdio">Debug STDIO</a>: this is a legacy debug variant that prints event information as ASCII messages.</li>
<li><b>Release</b>: this variant does not include additional debugging code. Use this variant when deploying the application.</li>
</ul>
<p>The figure below shows selection of <b>IPv4/IPv6 Debug</b> variant as an example. </p>
<div class="image">
<img src="nw_debug_variant.png" alt="nw_debug_variant.png"/>
</div>
<p>The <a class="el" href="group__net__evr.html">Debug Events</a> describes the events implemented in Network Services.</p>
<dl class="section note"><dt>Note</dt><dd>Users of MDK-Plus edition can only access <b> IPv4 Debug/Debug STDIO/Release</b> variants.</dd></dl>
<h2><a class="anchor" id="netEvrSupport"></a>
Event Recorder Support</h2>
 <script>link_ext('Event-Recorder-About');</script> is a powerful tool that provides visibility to the dynamic execution of the program. The Network Component generates <a class="el" href="group__net__evr.html">a broad set of Debug Events</a> for the Event Recorder and implements required infrastructure to interface with it.</p>
<p>To use the Event Recorder together with Network Component, it is required to create an image with event generation support. The necessary steps are:</p>
<ol type="1">
<li> <script>link_ext('Debug-Variant-Select');</script>: in the RTE management dialog select the <b>Debug</b> variant for the target <b>Network:Core</b> software component.</li>
<li> <script>link_ext('Event-Recorder-Enable');</script>: in the RTE management dialog enable the software component <b>Compiler:Event Recorder</b>.</li>
<li> <script>link_ext('Event-Recorder-Initialize');</script>: in the application code, call the function <b>EventRecorderInitialize</b>.</li>
<li> <script>link_ext('Event-Recorder-Configure');</script>: if necessary, adjust default Event Recorder configuration.</li>
<li>Build the application code, download it to the target hardware and start debug session.</li>
</ol>
<p>Now, when the network services generate event information, it can be viewed in the <script>link_ext('uv4-Event-Recorder');</script>.</p>
<h2><a class="anchor" id="netDebugStdio"></a>
STDIO Debug</h2>
<p>STDIO Debug is a legacy debug variant that prints event information as ASCII messages to a standard IO port. It is generally less feature-rich and slower than the debug with <a class="el" href="group__net__evr.html">Event Recorder</a> and is not recommended for new projects.</p>
<p>To enable STDIO debugging together with the Network Component, it is required to create an image that generates event information. The necessary steps are:</p>
<ol type="1">
<li>In the RTE management dialog select the <b>Debug STDIO</b> variant for the <b>Network:Core</b> software component. All necessary files, such as the <b>Net_Debug.c</b> file and the debug library will be automatically added to your project.</li>
<li>In the RTE management dialog enable <b>Compiler:I/O:STDOUT</b> component and select its <b>ITM</b> variant.</li>
<li>Configure the <a class="el" href="network_create_app.html#netDebugLevels">Debug Levels</a>.</li>
<li>Build the application code and download it to the target hardware.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>If the target system has only one serial port that is used by the PPP or SLIP Network Interface, then use <b>ITM</b> channel for printing debug messages. Otherwise, the debug messages will interfere with the IP packets and the system might malfunction or crash. The <b>ARM::Compiler</b> component helps you to configure the stdio channel.</li>
<li>If the debug mode is used on a high traffic LAN, the system might block. Reduce the amount of printed debug messages in <b>Net_Debug.c</b> configuration or disable the debug mode completely.</li>
</ul>
</dd></dl>
<p><a class="anchor" id="netDebugLevels"></a></p>
<h2>Debug Levels </h2>
<p>The system is made up of several modules that output debug messages. It is possible to configure the stdio debug output for each module separately. This can be done in the <b>Net_Debug.c</b> file. There are three debug levels available: </p>
<table class="doxtable">
<tr>
<th>Level </th><th>Description  </th></tr>
<tr>
<td>Off </td><td>The debug messages for the selected module are <b>disabled</b>. </td></tr>
<tr>
<td>Errors Only</td><td>Only error messages are output. This mode is useful for error tracking. </td></tr>
<tr>
<td>Full Debug </td><td>In this mode, <b>all</b> debug messages are output. </td></tr>
</table>
<p>The following debug options are available:</p>
<ul>
<li><b>Print Time Stamp</b> switch enables or disables printing the time information with debug messages. If this switch is not enabled, the timing information is not printed.</li>
<li><b>Debug level</b> for each module defines what kind of debug messages are printed.</li>
</ul>
<p>The owner module of the displayed debug message is identified by the message prefix. The following system and application modules are configurable for debugging: </p>
<table class="doxtable">
<tr>
<th>ID </th><th>Module </th><th>Description  </th></tr>
<tr>
<td>MEM </td><td>Memory Management Debug</td><td>Allocates and releases frame buffers. </td></tr>
<tr>
<td>ETH </td><td>Ethernet Debug </td><td>Handles Ethernet link. </td></tr>
<tr>
<td>PPP </td><td>PPP Debug </td><td>Handles serial line direct or modem connection PPP link. </td></tr>
<tr>
<td>SLIP </td><td>SLIP Debug </td><td>Handles serial line direct or modem connection SLIP link. </td></tr>
<tr>
<td>LOOP </td><td>Loopback Debug </td><td>Handles localhost loopback interface. </td></tr>
<tr>
<td>ARP </td><td>ARP Debug </td><td>Handles Ethernet MAC address resolution and caching. </td></tr>
<tr>
<td>IP4 </td><td>IPv4 Debug </td><td>Processes the IP version 4 network layer. </td></tr>
<tr>
<td>ICMP </td><td>ICMP Debug </td><td>Processes ICMP messages. Best known example is the ping. </td></tr>
<tr>
<td>IGMP </td><td>IGMP Debug </td><td>Processes IGMP messages, Hosts groups and IP Multicasting. </td></tr>
<tr>
<td>IP6 </td><td>IPv6 Debug </td><td>Processes the IP version 6 network layer. </td></tr>
<tr>
<td>ICMP6 </td><td>ICMPv6 Debug </td><td>Processes ICMP version 6 messages. Best known example is the ping. </td></tr>
<tr>
<td>NDP6 </td><td>NDP Debug </td><td>Handles Neighbor Discovery MAC address resolution and caching. </td></tr>
<tr>
<td>UDP </td><td>UDP Debug </td><td>Processes UDP frames. </td></tr>
<tr>
<td>TCP </td><td>TCP Debug </td><td>Processes TCP frames. </td></tr>
<tr>
<td>BSD </td><td>BSD Debug </td><td>Processes TCP and UDP frames via standard BSD Sockets API. </td></tr>
<tr>
<td>NBNS </td><td>NBNS Debug </td><td>The NetBIOS Name Service maintains name access to your hardware. </td></tr>
<tr>
<td>DHCP </td><td>DHCP Debug </td><td>Handles automatic configuration of IP address, Net mask, Default Gateway, and Primary and Secondary DNS servers. </td></tr>
<tr>
<td>DHCP6 </td><td>DHCP6 Debug </td><td>Handles automatic configuration of IP address in IP version 6. </td></tr>
<tr>
<td>DNS </td><td>DNS Debug </td><td>Handles the resolution of the IP address from a host name. </td></tr>
<tr>
<td>SNMP </td><td>SNMP Debug </td><td>Manages devices on IP network. </td></tr>
<tr>
<td>HTTP </td><td>HTTP Server Debug </td><td>Delivers web pages on the request to web clients. </td></tr>
<tr>
<td>FTP </td><td>FTP Server Debug </td><td>Manages the files stored on the server and serves the file requests received from the clients. </td></tr>
<tr>
<td>FTPC </td><td>FTP Client Debug </td><td>Connects to FTP server to transfer files on the server, and to manage files stored on the server. </td></tr>
<tr>
<td>TELN </td><td>Telnet Server Debug </td><td>Allows remote clients to control the system using the command line interface. </td></tr>
<tr>
<td>TFTP </td><td>TFTP Server Debug </td><td>A simple service which allows you to send files to or read files from the server. </td></tr>
<tr>
<td>TFTPC </td><td>TFTP Client Debug </td><td>Connects to TFTP server to send or receive files. </td></tr>
<tr>
<td>SMTP </td><td>SMTP Client Debug </td><td>Connects to SMTP server to send emails. </td></tr>
<tr>
<td>SNTP </td><td>SNTP Debug </td><td>Manages clock synchronization over the network. </td></tr>
</table>
<p>An example of the debug output is: </p>
<div class="fragment"><div class="line">015.0 ETH:*** Processing frame ***</div>
<div class="line">015.0 ETH: DstMAC 1E-30-6C-A2-45-5E</div>
<div class="line">015.0 ETH: SrcMAC 00-11-43-A4-FE-40</div>
<div class="line">015.0 ETH: Proto IP4, 66 bytes</div>
<div class="line">015.0 IP4:*** Processing frame ***</div>
<div class="line">015.0 IP4: SrcAddr 192.168.0.5</div>
<div class="line">015.0 IP4: DstAddr 192.168.0.150</div>
<div class="line">015.0 IP4: Proto TCP, Id=0x0622</div>
<div class="line">015.0 IP4: Length 52 bytes</div>
<div class="line">015.0 TCP:*** Processing frame ***</div>
<div class="line">015.0 TCP: Ports  : Src=49232, Dst=80</div>
<div class="line">015.0 TCP: Segment: Seq=0x31EDC88C, Ack=0x0</div>
<div class="line">015.0 TCP: Control: [SYN] Win=8192, Cks=0x0C67</div>
<div class="line">015.0 TCP: Mapped to Socket 1, state LISTEN</div>
<div class="line">015.0 TCP:Process Options, 12 bytes</div>
<div class="line">015.0 TCP: Opt-MSS: 1440</div>
<div class="line">015.0 TCP: SendWin: 8192</div>
<div class="line">015.0 TCP: RTO=4000ms (sa=0, sv=40)</div>
<div class="line">015.0 TCP: Next state SYN_REC</div>
</div><!-- fragment --><p> In the above example, Ethernet, IP and TCP debug messages are enabled:</p>
<ul>
<li>Received Ethernet packets are processed by the Ethernet layer and a debug message containing Ethernet header information is printed out. Ethernet debug information contains source and destination MAC address, Ethernet frame length and Ethernet protocol type.</li>
<li>The packet is then passed to the IP layer. IP layer prints out IP debug messages containing the IP header information such as source and destination IP address, frame length, protocol type etc.</li>
<li>When the IP layer has processed the packet, the packet is passed to the upper TCP layer. TCP layer prints out TCP debug messages containing the TCP header information such as source and destination ports, sequence and acknowledge numbers, checksum value, frame length etc.</li>
</ul>
<h2>Redirecting Output </h2>
<p>Debug messages are output to a standard IO port. The <script>link_ext('gs_low_level_routine');</script> <b>sendchar</b> function outputs a single character. If required, you can customize this function to send the debug messages to some other device. In most cases, a serial ITM debug channel is used to print out the debug messages.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>When the sendchar function runs in polling mode, printing all debug messages significantly reduces the performance. The preferred way is to rewrite the sendchar function to work in the interrupt mode.</li>
<li>Use the <b>highest baud rate</b> possible to reduce the impact on performance from printing the debug messages.</li>
<li>If the debug mode is enabled and the embedded system is connected to a <b>high traffic LAN</b> with plenty of broadcast packets, the system might malfunction.</li>
<li>Printing debug messages blocks out the system task scheduler during the time when the message is being sent from the serial port. The incoming IP packets accumulate in the memory. This soon causes an <b>out of memory </b>error. Any further incoming packets are lost until some memory is released.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="nw_runtime_config"></a>
Runtime Configuration</h1>
<p>It is often necessary to change the parameters and mode of operation of the network interface at startup or runtime. System control functions allow reading and changing the settings of the network interface and the system (for example the <a href="https://en.wikipedia.org/wiki/Hostname" target="_blank">hostname</a>).</p>
<p>This is required for using the same application code for serial production of embedded devices. The <b>runtime</b> <b>configuration</b> feature enables reading of configuration parameters from an EEPROM or SD Card and configuring the network interface for each embedded device differently.</p>
<p>To control the network interface options, you can use:</p>
<ul>
<li><a class="el" href="group__net_interfaces___common.html#gadbf28bb56266770f9b1d276c48c13d36">netIF_GetOption</a> function to retrieve the options</li>
<li><a class="el" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> function to set the options</li>
<li><a class="el" href="group__net_interfaces___common.html#ga7e16ce8f65945bfc49bee15172d6ad41">netIF_SetDefault</a> function to set default interface for internet access</li>
</ul>
<p>The options which can be changed are defined in the <a class="el" href="group__net_interfaces___enums.html#ga2e0460c920b348a8633c2e54ceecbed5">netIF_Option</a> enumerator. However, some interfaces do not support the complete set of available options. For example, the PPP interface does not have a MAC address. If you try to modify an unsupported option, an error is returned.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Localhost" target="_blank">localhost</a> name is used to access the embedded system without knowledge of its IP address. <a class="el" href="group__net_sys___func.html#ga6eda1bb2895a98252a851160c15111a5">netSYS_GetHostName</a> is used to retrieve the localhost name, whereas <a class="el" href="group__net_sys___func.html#ga141ae4581698cb95e5fc5c8458fa9710">netSYS_SetHostName</a> changes the localhost name.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol" target="_blank">DHCP</a> client can be disabled or enabled at runtime. When disabled, the user provided network parameters defined in the <b>Net_Config_ETH_0.h</b> configuration file are used. Switch the state of the DHCP client using <a class="el" href="group__ethernet__user__api.html#ga288cca4c23a75aaa6946f15ed70470cb">netDHCP_Disable</a> and <a class="el" href="group__ethernet__user__api.html#ga0c9df52aef8f05d93d89bb409d56e9d7">netDHCP_Enable</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Each embedded Ethernet device must have a unique <b>MAC</b> <b>address</b>, <b>IP</b> <b>address</b>, and <b>hostname</b>. This is very important when multiple devices are connected to the same LAN. Otherwise, the system might not work (due to collisions or disturbed network communications).</dd></dl>
<p><b>Code</b> <b>Example</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="rl__net_8h.html">rl_net.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* The following values are read from EEPROM */</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> mac_addr[]  = { <span class="stringliteral">&quot;00-01-02-32-3c-46&quot;</span> };</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> ip_addr[]   = { <span class="stringliteral">&quot;192.168.0.150&quot;</span>     };</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> def_gw[]    = { <span class="stringliteral">&quot;192.168.0.1&quot;</span>       };</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> net_mask[]  = { <span class="stringliteral">&quot;255.255.255.0&quot;</span>     };</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> pri_dns[]   = { <span class="stringliteral">&quot;194.25.2.129&quot;</span>      };</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> sec_dns[]   = { <span class="stringliteral">&quot;194.25.2.130&quot;</span>      };</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> host_name[] = { <span class="stringliteral">&quot;Keil_MCB&quot;</span>          };</div>
<div class="line"><span class="keywordtype">bool</span> DHCP_enabled      = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  uint8_t buf[8];</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="group__net_sys___func.html#ga0c68e74df79a37750413f72518f63f73">netInitialize</a> ();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Change host name */</span></div>
<div class="line">  <a class="code" href="group__net_sys___func.html#ga141ae4581698cb95e5fc5c8458fa9710">netSYS_SetHostName</a> (host_name);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Change MAC address */</span></div>
<div class="line">  <a class="code" href="group__net_gen___addr_conv_func.html#ga8f9dc823db5abb2bc6ccd8e1788c92da">netMAC_aton</a> (mac_addr, buf);</div>
<div class="line">  <a class="code" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> (<a class="code" href="rl__net__ds_8h.html#a005856112372179cbbdb9f815a563a6c">NET_IF_CLASS_ETH</a> | 0, <a class="code" href="rl__net__ds_8h.html#ga2e0460c920b348a8633c2e54ceecbed5a3433c9bf63b20186d9c9dc7359dc3d7e">netIF_OptionMAC_Address</a>, buf, <a class="code" href="rl__net__ds_8h.html#abc6c76b89cc97f1dd7ffb8f1a82e0754">NET_ADDR_ETH_LEN</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (DHCP_enabled == <span class="keyword">false</span>) {</div>
<div class="line">    <span class="comment">/* Static configuration mode */</span> </div>
<div class="line">    <a class="code" href="group__ethernet__user__api.html#ga288cca4c23a75aaa6946f15ed70470cb">netDHCP_Disable</a> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Change IP address */</span></div>
<div class="line">    <a class="code" href="group__net_gen___addr_conv_func.html#ga39518491393bd2b4c6f32df03768b6b8">netIP_aton</a> (ip_addr, <a class="code" href="rl__net__ds_8h.html#ab5ae61a54f36e338a8dc06cee088d89f">NET_ADDR_IP4</a>, buf);</div>
<div class="line">    <a class="code" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> (<a class="code" href="rl__net__ds_8h.html#a005856112372179cbbdb9f815a563a6c">NET_IF_CLASS_ETH</a> | 0, <a class="code" href="rl__net__ds_8h.html#ga2e0460c920b348a8633c2e54ceecbed5a3746e578ee900eb8d9619d36585a5e21">netIF_OptionIP4_Address</a>, buf, <a class="code" href="rl__net__ds_8h.html#a592ab2bc0921be0762e26d38621f62cd">NET_ADDR_IP4_LEN</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Change Network mask */</span></div>
<div class="line">    <a class="code" href="group__net_gen___addr_conv_func.html#ga39518491393bd2b4c6f32df03768b6b8">netIP_aton</a> (net_mask, <a class="code" href="rl__net__ds_8h.html#ab5ae61a54f36e338a8dc06cee088d89f">NET_ADDR_IP4</a>, buf);</div>
<div class="line">    <a class="code" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> (<a class="code" href="rl__net__ds_8h.html#a005856112372179cbbdb9f815a563a6c">NET_IF_CLASS_ETH</a> | 0, <a class="code" href="rl__net__ds_8h.html#ga2e0460c920b348a8633c2e54ceecbed5aae9f616813558d8a345bda00ca47004c">netIF_OptionIP4_SubnetMask</a>, buf, <a class="code" href="rl__net__ds_8h.html#a592ab2bc0921be0762e26d38621f62cd">NET_ADDR_IP4_LEN</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Change Default Gateway address */</span></div>
<div class="line">    <a class="code" href="group__net_gen___addr_conv_func.html#ga39518491393bd2b4c6f32df03768b6b8">netIP_aton</a> (def_gw, <a class="code" href="rl__net__ds_8h.html#ab5ae61a54f36e338a8dc06cee088d89f">NET_ADDR_IP4</a>, buf);</div>
<div class="line">    <a class="code" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> (<a class="code" href="rl__net__ds_8h.html#a005856112372179cbbdb9f815a563a6c">NET_IF_CLASS_ETH</a> | 0, <a class="code" href="rl__net__ds_8h.html#ga2e0460c920b348a8633c2e54ceecbed5abc895891ba1aea3b621808e613361208">netIF_OptionIP4_DefaultGateway</a>, buf, <a class="code" href="rl__net__ds_8h.html#a592ab2bc0921be0762e26d38621f62cd">NET_ADDR_IP4_LEN</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Change Primary DNS Server address */</span></div>
<div class="line">    <a class="code" href="group__net_gen___addr_conv_func.html#ga39518491393bd2b4c6f32df03768b6b8">netIP_aton</a> (pri_dns, <a class="code" href="rl__net__ds_8h.html#ab5ae61a54f36e338a8dc06cee088d89f">NET_ADDR_IP4</a>, buf);</div>
<div class="line">    <a class="code" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> (<a class="code" href="rl__net__ds_8h.html#a005856112372179cbbdb9f815a563a6c">NET_IF_CLASS_ETH</a> | 0, <a class="code" href="rl__net__ds_8h.html#ga2e0460c920b348a8633c2e54ceecbed5ad1dc6f54d4e047357eb0c5dacc75f3c2">netIF_OptionIP4_PrimaryDNS</a>, buf, <a class="code" href="rl__net__ds_8h.html#a592ab2bc0921be0762e26d38621f62cd">NET_ADDR_IP4_LEN</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Change Secondary DNS Server address */</span></div>
<div class="line">    <a class="code" href="group__net_gen___addr_conv_func.html#ga39518491393bd2b4c6f32df03768b6b8">netIP_aton</a> (sec_dns, <a class="code" href="rl__net__ds_8h.html#ab5ae61a54f36e338a8dc06cee088d89f">NET_ADDR_IP4</a>, buf);</div>
<div class="line">    <a class="code" href="group__net_interfaces___common.html#ga919bfb395143e0bc1775106080c61eb6">netIF_SetOption</a> (<a class="code" href="rl__net__ds_8h.html#a005856112372179cbbdb9f815a563a6c">NET_IF_CLASS_ETH</a> | 0, <a class="code" href="rl__net__ds_8h.html#ga2e0460c920b348a8633c2e54ceecbed5ad735ade79f2df5d930673a6be414dfc2">netIF_OptionIP4_SecondaryDNS</a>, buf, <a class="code" href="rl__net__ds_8h.html#a592ab2bc0921be0762e26d38621f62cd">NET_ADDR_IP4_LEN</a>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Feb 21 2018 20:27:02 for Network Component by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
